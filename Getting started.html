
<!-- saved from url=(0109)file:///E:/Projects/Espressif/Apps/xPL-ESP8266/trunk/Getting%20started%20with%20the%20ESP8266%20and%20xPL.htm -->
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

<meta name="ProgId" content="Word.Document">
<meta name="Generator" content="Microsoft Word 11">
<meta name="Originator" content="Microsoft Word 11">
<link rel="File-List" href="file:///E:/Projects/Espressif/Apps/xPL-ESP8266/trunk/Getting%20started%20with%20the%20ESP8266%20and%20xPL_files/filelist.xml">
<link rel="Edit-Time-Data" href="file:///E:/Projects/Espressif/Apps/xPL-ESP8266/trunk/Getting%20started%20with%20the%20ESP8266%20and%20xPL_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Getting started with the ESP8266 and xPL</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>pierre</o:Author>
  <o:LastAuthor>pierre</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>3218</o:TotalTime>
  <o:Created>2014-12-29T02:01:00Z</o:Created>
  <o:LastSaved>2014-12-29T02:01:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1520</o:Words>
  <o:Characters>8667</o:Characters>
  <o:Lines>72</o:Lines>
  <o:Paragraphs>20</o:Paragraphs>
  <o:CharactersWithSpaces>10167</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h3
	{mso-style-link:"Heading 3 Char";
	mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
code
	{font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
span.apple-converted-space
	{mso-style-name:apple-converted-space;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-locked:yes;
	mso-style-link:"Heading 3";
	mso-ansi-font-size:13.0pt;
	mso-bidi-font-size:13.0pt;
	font-family:Arial;
	mso-ascii-font-family:Arial;
	mso-hansi-font-family:Arial;
	mso-bidi-font-family:Arial;
	mso-ansi-language:EN-US;
	mso-fareast-language:EN-US;
	mso-bidi-language:AR-SA;
	font-weight:bold;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:375273225;
	mso-list-template-ids:-1255876580;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l0:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Courier New";}
@list l0:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
@list l0:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l0:level5
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Courier New";}
@list l0:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
@list l0:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l0:level8
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:"Courier New";}
@list l0:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Wingdings;}
@list l1
	{mso-list-id:1524588876;
	mso-list-type:hybrid;
	mso-list-template-ids:1185181448 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l2
	{mso-list-id:1695813186;
	mso-list-type:hybrid;
	mso-list-template-ids:1130680146 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang="EN-US" link="blue" vlink="purple" style="tab-interval:.5in">

<div class="Section1">

<p class="MsoNormal"><b style="mso-bidi-font-weight:normal"><span style="font-size:20.0pt">Getting started with the ESP8266 and <span class="SpellE">xPL</span> v1.1<o:p></o:p></span></b></p>

<p class="MsoNormal"><span style="font-size:20.0pt"><o:p>&nbsp;</o:p></span></p>

<h3>What is the ESP8266?</h3>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">The ESP8266 is a small, inexpensive (~$3) chipset designed
to connect embedded processors to a <span class="SpellE">Wifi</span> network. Its
small size and low price make it ideal for <span class="SpellE">IoT</span>
(Internet of Things) applications. Out of the box, it is designed to
communicate with a host processor using a simple serial interface, using
modem-like ‘AT’ commands. Many users have used this to interface with <span class="SpellE">Arduinos</span> and similar processors.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" align="center" style="text-align:center"><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" style='width:135pt;
 height:153.75pt'>
 <v:imagedata src="Getting%20started%20with%20the%20ESP8266%20and%20xPL_files/image001.jpg"
  o:title="IMG_4684"/>
</v:shape><![endif]--><!--[if !vml]--><img width="180" height="205" src="./Getting started_files/image002.jpg" v:shapes="_x0000_i1025"><!--[endif]--></p>

<p class="MsoNormal" align="center" style="text-align:center"><i style="mso-bidi-font-style:
normal">An ESP-01 module<o:p></o:p></i></p>

<p class="MsoNormal"><i style="mso-bidi-font-style:normal"><o:p>&nbsp;</o:p></i></p>

<p class="MsoNormal">What has the hacker community excited though, is the onboard
32 bit processor, which is user accessible. With the hard work of the pioneers
from the <a href="http://www.esp8266.com/">ESP8266 online community</a>, some
tools and an SDK have been made available.</p>

<p class="MsoNormal">Most <a href="http://l0l.org.uk/2014/12/esp8266-modules-hardware-guide-gotta-catch-em-all/">ESP8266
modules</a> have 4mb of flash memory onboard, with about 240kB-440kB available
for programs, and about 80kB of RAM, which makes this module more powerful than
most <span class="SpellE">Arduinos</span>. Also, anywhere between 0 and 9 <span class="SpellE">GPIOs</span> are available, with SPI, I2C available in addition to
the standard serial port.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<h3>What is <span class="SpellE">xPL</span>?</h3>

<p class="MsoNormal" style="mso-layout-grid-align:none;text-autospace:none"><span style="font-size:11.0pt;font-family:&quot;Courier New&quot;"><o:p>&nbsp;</o:p></span></p>

<p class="MsoNormal"><b style="mso-bidi-font-weight:normal"><a href="http://xplproject.org.uk/"><span class="SpellE"><span class="GramE">xPL</span></span></a></b>
is an open protocol intended to permit the control and monitoring of home
automation devices. The primary design goal of <span class="SpellE">xPL</span> is
to provide a rich set of features and functionality, whilst maintaining an
elegant, uncomplicated message structure. The protocol includes complete
discovery and auto-configuration capabilities which support a fully
“plug-n-play” architecture – essential to ensure a good end-user experience.</p>

<p class="MsoNormal">Many developers have contributed interfaces for many Home
Automation devices and systems. </p>

<b><span style="font-size:13.0pt;font-family:Arial;mso-fareast-font-family:
&quot;Times New Roman&quot;;mso-ansi-language:EN-US;mso-fareast-language:EN-US;
mso-bidi-language:AR-SA"><br clear="all" style="page-break-before:always">
</span></b>

<h3>About the <span class="SpellE">xPL</span> for ESP8266 project</h3>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">This small project will allow you to turn an ESP8266 module
into an <span class="SpellE">xPL</span> node. I used an ESP-01 variant (pictured
above), since it has two available <span class="SpellE">GPIOs</span>, GPIO0 and
GPIO2. Although these <span class="SpellE">GPIOs</span> are used during the boot
process, with some care, they can be used by applications. The application
currently does two things:</p>

<ul style="margin-top:0in" type="disc">
 <li class="MsoNormal" style="mso-list:l2 level1 lfo1;tab-stops:list .5in">Responds
     to <span class="SpellE">xPL</span> X10.BASIC ON and OFF commands, on a
     user-defined address, to turn on or off GPIO0. I have connected this to a
     LED for easy confirmation.</li>
 <li class="MsoNormal" style="mso-list:l2 level1 lfo1;tab-stops:list .5in">Generates
     an <span class="SpellE">xPL</span> X10.BASIC trigger command based on the
     state of GPIO2. Grounding GPIO2 generates an ON trigger, releasing it
     generates an OFF trigger.</li>
</ul>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">To give users the most flexibility, I built this example
using the <a href="http://www.freertos.org/"><span class="SpellE">FreeRTOS</span></a>-based
SDK supplied by the makers of the chip, <a href="http://espressif.com/"><span class="SpellE">Espressif</span></a>. <span class="SpellE">FreeRTOS</span> is an
open-source RTOS (Real-Time Operating System) for embedded processors. The code
is written in C. For the <span class="SpellE">xPL</span> code, I mainly converted
Olivier Lebrun’s <span class="SpellE">xPL</span> for <span class="SpellE">Arduino</span>
code to straight C.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">Just getting the tools up and running and figuring out ways
to work around the limitations of the SDK was a challenge, but this document
will allow you to hit the ground running to develop your own application.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<h3>Connecting the board</h3>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">The ESP8266 runs on 3.3V and is NOT 5V TOLERANT, so you
cannot just connect it to an <span class="SpellE">Arduino</span>. As the chip can
draw up to 300mA when transmitting, you will need a good power supply. If in
doubt, use a large capacitor (&gt;100uf) to regulate the supply, near the chip.
Failure to do so will result in instability.</p>

<p class="MsoNormal">Since the firmware is uploaded through the serial interface,
you will typically use a USB to serial adapter. Make sure that you get one that
works at 3.3V! Here is the one I use:</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal"><a href="http://www.ebay.ca/itm/FT232RL-USB-Serial-TTL-level-5V-3-3V-Module-Converter-Adapter-Arduino-/181140044590?pt=LH_DefaultDomain_0&hash=item2a2cc9bb2e">FT232RL
USB to Serial</a> </p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">This one clearly has a 3V/5V switch, so you can use it
safely.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal"><span lang="FR-CA" style="mso-ansi-language:FR-CA"><!--[if gte vml 1]><v:shape
 id="_x0000_i1026" type="#_x0000_t75" style='width:441pt;height:306pt'>
 <v:imagedata src="Getting%20started%20with%20the%20ESP8266%20and%20xPL_files/image003.emz"
  o:title="" croptop="5671f" cropbottom="10713f" cropleft="2731f" cropright="10923f"/>
</v:shape><![endif]--><!--[if !vml]--><img border="0" width="588" height="408" src="./Getting started_files/image004.gif" v:shapes="_x0000_i1026"><!--[endif]--><o:p></o:p></span></p>

<p class="MsoNormal"><i style="mso-bidi-font-style:normal"><span lang="FR-CA" style="mso-ansi-language:FR-CA">ESP-01 Hardware connections<o:p></o:p></span></i></p>

<p class="MsoNormal"><span lang="FR-CA" style="mso-ansi-language:FR-CA"><o:p>&nbsp;</o:p></span></p>

<p class="MsoNormal">To get the chip into firmware update mode, the chip needs to
be reset while GPIO0 is held low and GPIO2 is held high. The above circuit uses
the USB-serial adapter’s DTR line to pull GPIO0 low and reset the chip via a
small capacitor. GPIO0 needs to be held down for about 15ms after reset for the
chip to go into firmware update mode. After that, GPIO0 needs to be released,
as the <span class="SpellE">bootloader</span> then reconfigures GPIO0 as an
output. All of this is handled automatically by the flash tool.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<h3>Toolset installation</h3>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">The following lists all the software components I have
gathered in order to create and upload firmware for the ESP8266. Most of these
components have been supplied by other hobbyists and are subject to change or
move. Even the official SDKs supplied by <span class="SpellE">Espressif</span>
seem to evolve rather quickly.</p>

<p class="MsoNormal">This particular version of the toolset is designed to work
under Windows 7 or 8. Linux users have other options available. In particular, <span class="SpellE">Espressif</span> has released a VM file that you can run within <span class="SpellE">VirtualBox</span>, with all the tools pre-installed. It runs
within a <span class="SpellE">Lubuntu</span> environment.</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal">Here is a step by step guide:</p>

<p class="MsoNormal"><o:p>&nbsp;</o:p></p>

<ul style="margin-top:0in" type="disc">
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Create
     a directory to put all your ESP stuff in. I put mine in<span class="apple-converted-space">&nbsp;</span><b>E:\ESP8266</b>, but obviously
     yours will be different.</li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Get <a href="https://www.python.org/downloads/">Python 2.7X</a>. Install it where
     you want. I put it in<span class="apple-converted-space">&nbsp;</span><b>E:\Python27</b>.</li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">You
     need <span class="SpellE">PySerial</span> (<a href="http://pyserial.sourceforge.net/"><span style="color:#1E8FC7">http://pyserial.sourceforge.net/</span></a>).</li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Get <span class="SpellE">minGW</span> (<a href="http://www.mingw.org/"><span style="color:#1E8FC7">http://www.mingw.org/</span></a>). In the package
     manager, choose<span class="apple-converted-space">&nbsp;</span><span class="SpellE"><b>mingw</b></span><b>-developer-toolkit</b><span class="apple-converted-space">&nbsp;</span>and<span class="apple-converted-space">&nbsp;</span><span class="SpellE"><b>mingw</b></span><b>-base</b>.
     This will give you<span class="apple-converted-space">&nbsp;</span><b>make.exe</b><span class="apple-converted-space">&nbsp;</span>and some important utilities,
     like <b>mkdir.exe</b><span class="apple-converted-space">&nbsp;</span>that
     the <span class="SpellE">makefiles</span> will need.</li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Get
     the <span class="SpellE">sdk</span> (<a href="http://bbs.espressif.com/viewtopic.php?f=5&t=67"><span class="SpellE"><span style="color:#1E8FC7">Espressif</span></span><span style="color:#1E8FC7"> RTOS SDK</span></a>). Install it under your chosen
     directory. Mine is in<span class="apple-converted-space">&nbsp;</span><b>E:\ESP8266\esp_iot_rtos_sdk-master.</b></li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in"><span style="mso-bidi-font-weight:bold">Download the missing libraries for the
     SDK: <a href="https://github.com/espressif/esp_iot_rtos_sdk_lib/archive/master.zip"><span class="SpellE">FreeRTOS</span> libraries for SDK</a>. Add them to the <b>E:\ESP8266\esp_iot_rtos_sdk\lib</b>
     directory.</span></li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Get
     the <a href="https://drive.google.com/file/d/0B1kVUQJ3na10RkhtRDE1UFZBVzg/view?usp=sharing">pre-built
     compiler</a>. Stick it in your chosen directory. Mine is in<span class="apple-converted-space">&nbsp;</span><b>E:\ESP8266\xtensa-lx106-elf</b>.</li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Get
     the missing <span class="SpellE">xtensa</span> includes for <span class="SpellE">gcc</span> <a href="http://bbs.espressif.com/viewtopic.php?f=5&t=67">here</a>. It is
     the file <b style="mso-bidi-font-weight:normal">xtensa.tar.bz2. </b>Extract
     them into the compiler subdirectory: <b style="mso-bidi-font-weight:normal">E:\ESP8266\xtensa-lx106-elf\xtensa-lx106-elf\include.</b></li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Get
     the source code for the <a href="https://github.com/peteben/xPL-ESP8266"><span class="SpellE">xPL</span> example project</a>. Install it into a directory
     under your chosen project directory. Mine are in <b>E:\ESP8266\Apps\xPL-ESP8266.</b></li>
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in">Now
     you need to correctly setup your path. You can of course add things to
     your global user path, but I like to setup a separate command prompt for
     things like this. I created a file called <span class="SpellE"><b>Vars.cmd</b></span>,
     that sets up the path for working with the ESP toolset:</li>
 <div style="mso-element:para-border-div;border:solid #DDDDDD 1.0pt;mso-border-alt:
 solid #DDDDDD .75pt;padding:2.0pt 2.0pt 2.0pt 2.0pt;margin-left:.25in;
 margin-right:.75pt">
 <li class="MsoNormal" style="margin-left:.25in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in;border:none;mso-border-alt:solid #DDDDDD .75pt;
     padding:0in;mso-padding-alt:2.0pt 2.0pt 2.0pt 2.0pt"><code><span style="font-size:11.0pt;color:black">@echo off</span></code><span style="font-size:11.0pt;font-family:&quot;Courier New&quot;;color:black"><br>
     <code><span style="mso-ansi-font-size:11.0pt;mso-bidi-font-size:11.0pt">PATH=%PATH%;E:\ESP8266\xtensa-lx106-elf\bin;E:\MinGW\bin;E:\MinGW\msys\1.0\bin</span></code></span></li>
 </div>
</ul>

<ul style="margin-top:0in" type="disc">
 <li class="MsoNormal" style="margin-left:.75in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">Then I setup a desktop shortcut for a command <span class="SpellE">prompt<span class="GramE">:<b>%</b></span><b>comspec</b></span><b>%
     /k E:\ESP8266\VARS.cmd</b>. When I click this I get a command prompt with
     the proper path already set.</li>
 <li class="MsoNormal" style="margin-left:.75in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">For the same reason, I also created a batch file that
     sets up the path before calling make:</li>
 <div style="mso-element:para-border-div;border:solid #DDDDDD 1.0pt;mso-border-alt:
 solid #DDDDDD .75pt;padding:2.0pt 2.0pt 2.0pt 2.0pt;margin-left:.25in;
 margin-right:.75pt">
 <li class="MsoNormal" style="mso-list:l1 level1 lfo2;tab-stops:list .5in;
     border:none;mso-border-alt:solid #DDDDDD .75pt;padding:0in;mso-padding-alt:
     2.0pt 2.0pt 2.0pt 2.0pt"><code><span style="font-size:11.0pt;color:black">@echo
     off</span></code><span style="font-size:11.0pt;font-family:&quot;Courier New&quot;;
     color:black"><br>
     <code><span style="mso-ansi-font-size:11.0pt;mso-bidi-font-size:11.0pt">call
     E:\ESP8266\vars.cmd</span></code><br>
     <code><span style="mso-ansi-font-size:11.0pt;mso-bidi-font-size:11.0pt">make
     %1 %2 %3 %4 %5</span></code></span></li>
 </div>
</ul>

<ul style="margin-top:0in" type="disc">
 <li class="MsoNormal" style="margin-left:1.0in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">So in my project setup, in Visual Studio, I use
     ESPMAKE instead of make.</li>
 <li class="MsoNormal" style="margin-left:1.0in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">Modify the <span class="SpellE">makefile</span> in the
     xPL_ESP8266 project so that it reflects your locations for the tools and <span class="SpellE">sdk</span>. You should be able to compile and flash by simply
     typing ‘make’ or ‘make flash’ in the xPL_ESP8266 directory.</li>
 <li class="MsoNormal" style="margin-left:1.0in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">Get the enhanced <a href="https://github.com/peteben/ESP-Termie">serial terminal and firmware
     tool</a>. You need the modified Python tool to flash the chip, <span class="SpellE"><b style="mso-bidi-font-weight:normal">esptool-py.py</b></span><b style="mso-bidi-font-weight:normal">. </b>This version is enhanced to
     reset the chip and bring it into firmware update mode automatically by
     using DTR. It also connects to <span class="SpellE">Termie</span>, the
     serial terminal application to share the serial port connection.</li>
 <li class="MsoNormal" style="margin-left:1.0in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">Compile ‘<span class="SpellE">Termie</span>’ the serial
     terminal. I modified this program to use a named pipe to communicate with
     the <span class="SpellE"><b style="mso-bidi-font-weight:normal">esptool-py</b></span>
     flasher application. Thus it knows when to disconnect from the serial port
     when you want to flash the chip.</li>
 <li class="MsoNormal" style="margin-left:1.0in;mso-list:l1 level1 lfo2;
     tab-stops:list .5in">You can use Visual Studio as your development IDE, by
     adding your project as a C++ <span class="SpellE">Makefile</span> project. I
     have included sample project files. You need to modify the project
     properties to setup your make command and add the include directories in
     the configuration so that <span class="SpellE">intellisense</span> can show
     you function definitions in the editor. I recommend that you get the free <a href="http://www.visualstudio.com/en-us/news/vs2013-community-vs.aspx">Visual
     Studio 2013 community edition</a><span class="GramE">..</span></li>
</ul>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.75in"><span class="GramE"><span class="Heading3Char"><span style="font-size:13.0pt">Things to watch out for.</span></span></span>
</p>

<p class="MsoNormal" style="margin-left:.75in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.75in">You cannot use most of the
standard ‘C’ libraries, as they are not compatible with the runtime. The <span class="SpellE">sdk</span> does provide many common functions, like ‘<span class="SpellE">printf</span>’, ‘<span class="SpellE">memcpy</span>’, and similar,
but I had to scrounge the Internets to get source code to some missing
functions, like ‘<span class="SpellE">sscanf</span>’, ‘<span class="SpellE">strlcpy</span>’.
</p>

<p class="MsoNormal" style="margin-left:.75in">By default, all code goes into <span class="SpellE">iram</span>, which is only 32k, so it is easy to overflow that
segment by linking in a bunch of stuff from the libraries or from your own code.
</p>

<p class="MsoNormal" style="margin-left:.75in">Use ICACHE_FLASH_ATTR on your
functions to make sure they go into <span class="SpellE">irom</span> instead.<span class="apple-converted-space">&nbsp;<span class="SpellE">Irom</span> resides
off-chip on a 4M flash ROM, thus leaving about 240-440kB for applications. Although
the final compiled program appears huge (about 180k in <span class="SpellE"><span class="GramE">irom</span></span><span class="GramE">,</span> and 28k in <span class="SpellE">iram</span>), most of this is library code that runs the <span class="SpellE">Wifi</span> and IP stacks. The actual user application is
something like 8k.<o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left:.75in"><span class="apple-converted-space"><o:p>&nbsp;</o:p></span></p>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<h3 style="margin-left:.5in"><span class="GramE">Questions?</span></h3>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.5in">The <a href="http://www.esp8266.com/">ESP8266 community forums</a> are an important
resource, along with the wiki. For <span class="SpellE">xPL</span> related
queries, the <a href="http://xplproject.org.uk/forums/viewforum.php?f=2"><span class="SpellE">xPL</span> forums</a> will be a good place to start.</p>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.5in">Have fun!</p>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.5in"><span lang="FR" style="mso-ansi-language:
FR">Pierre B</span><span class="SpellE"><span lang="FR-CA" style="mso-ansi-language:
FR-CA">énard</span></span><span lang="FR-CA" style="mso-ansi-language:FR-CA"> <o:p></o:p></span></p>

<p class="MsoNormal" style="margin-left:.5in"><span lang="FR-CA" style="mso-ansi-language:
FR-CA"><o:p>&nbsp;</o:p></span></p>

<p class="MsoNormal" style="margin-left:.5in"><span style="background:white;
mso-highlight:white"><a href="mailto:xsc.peteben@neverbox.com">xsc.peteben@neverbox.com</a></span></p>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<h3 style="margin-left:.5in"><span style="font-size:12.0pt">Version History<o:p></o:p></span></h3>

<p class="MsoNormal" style="margin-left:.5in"><o:p>&nbsp;</o:p></p>

<p class="MsoNormal" style="margin-left:.5in">V1.0<span style="mso-tab-count:
1">&nbsp;&nbsp;&nbsp; </span>Initial release</p>

<p class="MsoNormal" style="margin-left:1.0in;text-indent:-.5in">V1.1<span style="mso-tab-count:1">&nbsp;&nbsp;&nbsp; </span>Streamlined tools installation by indicating
the location of a 32-bit compiler. Changed default directory to <b style="mso-bidi-font-weight:normal">E:\ESP8266. </b><span class="GramE">Removed
dependence on esptool.exe by using the python <span class="SpellE">esptool-py</span>
to generate firmware images.</span> <span class="GramE">Updated link to ‘<span class="SpellE">Termie</span>’.</span> <span class="GramE">Added link to Python 2.7.</span>
<span class="GramE">Revised library warning.</span> Added ‘What is <span class="SpellE">xPL</span>’ section.<span style="mso-tab-count:1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><b style="mso-bidi-font-weight:normal"><o:p></o:p></b></p>

<p class="MsoNormal" style="margin-left:1.0in;text-indent:-.5in"><b style="mso-bidi-font-weight:normal"><o:p>&nbsp;</o:p></b></p>

</div>




</body></html>